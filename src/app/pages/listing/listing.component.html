
<div class="flex justify-content-center">
    <div style="max-width: 1300px;" class="flex flex-column w-full justify-content-start align-items-center">
        <div >
            <img style="width: 100%; height: 600px; object-fit: cover;" class="border-round-3xl" src="{{listing.image}}" alt="">
        </div>
        <div class="flex align-content-start">
            <div class="col-8">
                <div class="flex flex-column align-items-start">
                    <p-breadcrumb class="max-w-full" [model]="items" [home]="home" />

                    <div class="flex flex-column align-items-start gap-2">
                        <p class="text-5xl">{{listing.title | titlecase}}</p>
                        <p class="text-xl">{{listing.people[0]}} Travellers - {{listing.days}} Days - {{listing.days - 1}} Nights</p>
                        <div class="flex justify-content-center gap-2">
                            <p>{{listing.rating | ratingPipe}}</p>
                            <p-rating [(ngModel)]="listing.rating" [stars]="5" />
                            <p>{{listing.reviews}} Reviews</p>
                        </div>
                        <div class="flex gap-1">
                            @for (tag of listing.tags; track $index) {
                                <span class="flex py-1 z-5 px-2 text-sm bg-gray-300 text-black-alpha-90 border-round-3xl">
                                    <p class="">{{tag | titlecase}}</p>
                                </span>
                            }
                            @for (category of listing.categories; track $index) {
                                <span class="flex py-1 z-5 px-2 text-sm  bg-white border-1 border-round-3xl">
                                    <p class="">{{category | titlecase}}</p>
                                </span>
                            }
                        </div>
                        <p class="text-lg">{{listing.descrption}}</p>
                    </div>
            
                    <div class="flex flex-column">
                        <!-- <p class="text-2xl">Overview</p> -->
                        <p-table [value]="listing.itenerary.days" [tableStyle]="{ 'min-width': '50rem' }">
                            <ng-template pTemplate="header">
                                <tr>
                                    <th>Cities</th>
                                    <th>Cities</th>
                                    <th>Cities</th>
                                    <th>Cities</th>
                                </tr>
                            </ng-template>
                            <ng-template pTemplate="body" let-day>
                                <tr>
                                    <td>{{ day.cities[0] }}</td>
                                    <td>test</td>
                                    <td>testing, testing</td>
                                    <td>Day</td>
                                </tr>
                            </ng-template>
                        </p-table>
                    </div>

<!-- Itenerary Layout -->
                    <div [class]="userHasViewPermission ? 'pointer-events-none' : ''" [ngStyle]="{'filter': !userHasViewPermission ? 'blur(4px)' : ''}">
                        <p class="text-4xl mt-4">Itinerary</p>
                        <p class="text-lg">{{listing.itenerary.caption}}</p>
                
                        <p-accordion [multiple]="true" [activeIndex]="[0]" expandIcon="fa-solid fa-circle-dot" collapseIcon="fa-solid fa-circle" [style]="{'width': '100%'}">
                            @for (day of listing.itenerary.days; track $index) {
                            <p-accordionTab header="Day: {{day.cities[0]}} - {{day.cities[1]}}">
                                <div class="pl-4">
                                    @if(day.photos) {
                                        <img style="width: 100%; height: 400px;" class="border-round-3xl" src="{{day.photos[0]}}" alt="">
                                    }
                                    <p class="text-xl">{{day.overview}}</p>
                                    <div class="flex flex-column align-items-start justify-content-start">
                                        @if(day.accomodations) {
                                            <h2 class="ml-3">Accomodations</h2>
                                            @for (accomodation of day.accomodations; track $index) {
                                                <div class="flex flex-column align-items-center cursor-pointer" (click)="handleLink(accomodation.link)">
                                                    <img style="width: 200px; height: 100px;" class="border-round-3xl" src="{{accomodation.photo}}" alt="">
                                                    <p>Hotel Name</p>
                                                    @if(accomodation.rating){
                                                        <p-rating [(ngModel)]="accomodation.rating" stars="5"/>
                                                    }
                                                </div>
                                            }
                                        }
                                    </div>
                                    <div class="flex flex-column align-items-start justify-content-start">
                                        @if(day.activities) {
                                            <h2 class="ml-3">Activities</h2>
                                            @for (activity of day.accomodations; track $index) {
                                                <div class="flex flex-column align-items-center cursor-pointer" (click)="handleLink(activity.link)">
                                                    <img style="width: 200px; height: 100px;" class="border-round-3xl" src="{{activity.photo}}" alt="">
                                                    <p>Activity Name</p>
                                                    @if(activity.rating){
                                                        <p-rating [(ngModel)]="activity.rating" stars="5"/>
                                                    }
                                                </div>
                                            }
                                        }
                                    </div>
                                    <div class="flex flex-column align-items-start justify-content-start">
                                        @if(day.restaurants) {
                                            <h2 class="ml-3">Restaurants</h2>
                                            @for (restaurant of day.accomodations; track $index) {
                                                <div class="flex flex-column align-items-center cursor-pointer" (click)="handleLink(restaurant.link)">
                                                    <img style="width: 200px; height: 100px;" class="border-round-3xl" src="{{restaurant.photo}}" alt="">
                                                    <p>Restaurant Name</p>
                                                    @if(restaurant.rating){
                                                        <p-rating [(ngModel)]="restaurant.rating" stars="5"/>
                                                    }
                                                </div>
                                            }
                                        }
                                    </div>
                                </div>
                            </p-accordionTab>
                            }
                        </p-accordion>
                
                        <div class="flex">
                            @for (accomodation of listing.accomodations; track $index) {
                                <div class="flex flex-column align-items-center cursor-pointer" (click)="handleLink(accomodation.link)">
                                    <img style="width: 200px; height: 100px;" class="border-round-3xl" src="{{accomodation.photo}}" alt="">
                                    <p>Hotel Name</p>
                                    @if(accomodation.rating){
                                        <p-rating [(ngModel)]="accomodation.rating" stars="5"/>
                                    }
                                </div>
                            }
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-4 pt-4 pl-6">
                <p-card>
                    <div class="flex flex-column justify-content-center text-center">
                        <p class="text-sm">Estimated Total</p>
                        <p class="text-3xl font-bold text-black-alpha-90">{{listing.price | currency}}</p>
                        <p class="text-sm">Icludes: acoomodations, activities, and meals</p>
                        <p-button label="View Expense List" severity="contrast" class="w-full" styleClass="w-full" />
                        <div>
                            <img style="width: 80px; height: 80px; object-fit: cover;" class="border-circle" src="{{listing.creator.image}}" alt="">

                        </div>
                    </div>
                    <ng-template #footer>
                        <div class="flex gap-3">
                            <p-button label="Download" icon="pi-arrow-circle-down" severity="contrast" class="w-full" [outlined]="true" styleClass="w-full" />
                            <p-button label="Wishlist" icon="pi-heart" severity="contrast" class="w-full" styleClass="w-full" />
                        </div>
                    </ng-template>
                </p-card>
                <div class="flex w-full justify-content-center gap-3 pt-3">
                    <a href=""><i class="text-2xl fa-brands fa-square-facebook"></i></a>
                    <a href=""><i class="text-2xl fa-brands fa-instagram"></i></a>
                    <a href=""><i class="text-2xl fa-brands fa-whatsapp"></i></a>
                    <a href=""><i style="top: 2px;" class="relative text-xl fa-solid fa-link"></i></a>
                </div>
            </div>
        </div>
        <div class="divider my-4"></div>
        <!-- User Information -->
        <div class="w-full grid">
            <div class="col-4">
                <p-card class="shadow-3">
                    <div class="flex">
                        <div class="flex flex-column align-items-center">
                            <img style="width: 100px; height: 100px; object-fit: cover;" class="border-round-3xl" src="{{listing.creator.image}}" alt="">
                            <h4>{{listing.creator.name}}</h4>
                            <p class="text-xs font-bold">{{listing.creator.title}}</p>
                        </div>
                        <div class="flex flex-column">
                            <div class="flex flex-column">
                                <p>{{listing.creator.reviews}}</p>
                                <p class="text-xs">Reviews</p>
                            </div>
                            <div class="flex flex-column">
                                <p>{{listing.creator.rating}}</p>
                                <p class="text-xs">Rating</p>
                            </div>
                            <div class="flex flex-column">
                                <p>{{listing.creator.joined | date}}</p>
                                <p class="text-xs">Joined</p>
                            </div>
                        </div>
                    </div>
                </p-card>
            </div>
            <div class="col-8">
                <div>
                    <h5 class="text-xl">{{listing.creator.name}} is a {{listing.creator.title}}</h5>
                    <p>{{listing.creator.about}}</p>
                </div>
                <div>
                    <h5 class="text-xl">{{listing.creator.name}} is a {{listing.creator.title}}</h5>
                    <p>{{listing.creator.about}}</p>
                </div>
                <p-button label="View Profile" severity="contrast"/>
            </div>
        </div>
    </div>
</div>
